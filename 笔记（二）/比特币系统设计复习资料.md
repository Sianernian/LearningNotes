12月28日课程笔记
@author：于洪伟
@Theme：比特币系统设计复习提纲

1、第一章：关于比特币
时间：2008年
人物：中本聪
全称：Bitcoin：A Peer-to-Peer Electronic Cash System
（背诵默写）
启动时间：2009年1月3日创世区块生成

2、第二章：比特币的工作原理
关键词：交易、区块、挖矿、区块链（关键词）
比特币的原理：
① 比特币网络中，一个节点向另外一个节点发送数据，称之为交易，或称转账
② 交易的数据以数据包的形式打包存储起来，这些数据包被称之为区块
③ 区块的产生需要多个节点共同竞争，胜出的节点有权利记录区块数据，并获得相应的奖励。
④ 比特币系统中的奖励是BTC，各节点竞争记账并获得奖励的过程称为“挖矿”
⑤ 生成的区块数据包按照一定的先后顺序进行排列，形成一条链式结构，称之为区块链

3、第三章：比特币核心客户端
全称：Bitcoin Core、又称之为：中本聪客户端
下载地址：http://github.com/bitcoin/realease

比特币客户端的架构图：P36页。

比特币客户端配置文件：bitcoin.conf
比特币客户端配置可选项：
	test ：配置为是否是测试网络
	server：配置是否启动RPC服务，1表示启动
	rpcuser：配置访问rpc服务的用户名
	rpcpassword：配置访问rpc服务的密码
	...

比特币客户端的RPC命令：（至少10个命令）
	getblockcount：获取当前节点的区块总数
	getbestblockhash：获取最新区块的hash值
	getblockhash height：获取指定高度的区块hash值
		height：指定区块高度，整数类型
	getblock hash：获取指定hash值对应的区块的信息
		hash：指定区块的hash，字符串类型
	getblockchaininfo：获取当前区块链节点的信息
	getpeerinfo：获取与当前节点连接的对等节点的信息
	getnewaddress label type：获取一个新的比特币的地址
		label：地址标签、可以任意的字符串
		type：类型，三种可选：legacy、p2sh-segwit、bech32
	createrawtransaction：创建一个新的交易
	signrawtransaction：签名一个新的交易
	sendrawtransaction：发送一笔新的交易
	....

代码实践：RPC通信协议

JSON-RPC协议：

请求协议格式：（4个字段)
	id：请求的唯一标识
	jsonrpc：rpc协议的版本2.0
	method：rpc服务要调用的方法或者功能或者命令
	params：调用rpc服务时要传递的参数，数组[]格式

响应协议格式：(3个字段)
	id：请求的唯一标识
	error：错误信息
	result：返回结果，格式有很多中：整数、字符串、Object....

代码实现：
请求头的设置：Header
	Encoding：编码格式，通常为UTF-8
	Content-Type：交互的数据类型，比如application/json
	Authorization：认证，"Basic "+Base64(user+":"+pwd)

4、第四章：密钥和地址
目标：①密钥的地址的概念 ② 密钥和地址的关系 ③ 密钥和签名的关系

① 密钥的概念：比特币中的秘钥由一对密钥组成，分为私钥和公钥。先随机生成私钥，一个私钥对应一个公钥。
② 地址的概念：地址用于抽象了收款人的概念，用地址代表交易的收款人。

③ 密钥的地址的关系：
	依赖的数学原理：椭圆曲线方程 -> 椭圆曲线密码学
	随机生成私钥 -> 推导得到对应的公钥 —> 变换计算 -> 比特币地址

④ 比特币地址的生成步骤：（10分）
	a、利用椭圆曲线数字签名算法，随机生成一个私钥pri
	b、根据私钥获取到对应的公钥pub
	c、将公钥进行hash计算：先进行sha256，后进行Ripemd160
	d、在步骤c得到结果前面追加版本号，通常为0x00
	e、将步骤c的结果进行双SHA256计算
	f、取步骤e的结果的前4个字节，作为比特币地址的校验位数据
	g、将步骤d的结果与步骤f中得到校验位数据进行拼接，得到比特币地址
	h、将步骤g得到的比特币地址进行Base58编码，最后得到地址结果

⑤ 加密私钥：对私钥进行加密保护。通常使用的是AES算法或者其他算法
BIP-38：统一对私钥进行加密保护的一项提案。

BIP：比特币改进协议。BIP的类型：标准、信息、过程

5、钱包：2021年计划


6、第六章：交易

交易的结构：一笔交易包含交易输入和交易输出。一笔交易中可以有多笔交易输入或者是多笔交易输出。

交易的类别：
	a、转账：最普通的交易
	b、铸币交易：CoinBase交易, 区块当中的第一笔交易，该笔交易的特点是由系统发起，转一定数量的比特币到某个矿工地址，coinbase交易是比特币的发行方式。

交易输入：比特币交易中要花费的钱，做为交易的输入。
交易输出：比特币交易中未花费的钱，作为交易的输出。

UTXO：UnSpent Transaction Output，未花费的交易输出。

交易输入的结构：（4字段）
	txid：引用的交易的交易id
	vout：引用的交易中的交易输出的索引
	scriptSig：解锁脚本，用于去解锁所引用的交易输出中的锁定脚本
	sequence：序列号
交易输出的结构：（2字段）
	value：一定面额的比特币
	scriptPubKey：锁定脚本，利用该脚本将一定数量的比特币锁定在utxo上，等待解锁脚本进行验证

比特币的交易类型：（5种）（10分）
	P2PKH：pay-to-public-key hash
	P2SH：pay-to-script hash
	P2PK：pay-to-public-key
	P2WPKH：pay-to-witness-public-key hash
	P2WSH：pay-to-witness-scirpt hash

比特币激励机制：挖矿的区块奖励、交易的手续费

脚本语言：基于栈数据结构执行的语言，语法单一，功能简单，无法执行逻辑

非图灵完备 和 图灵完备 的区别？ 是否可以进行逻辑判断、循环流程等处理

数字签名：
	公式： Sig = Fsig(Fhash(m),dA)
	解释：
		m代表交易，dA代表私钥
		Fhash代表的是hash计算，比特币中是SHA256
		Fsig代表的是数字签名算法，比特币中是ECDSA

三种签名散列类型：ALL、NONCE、SINGLE


交易的序列化：
目的：为了网络传输和持久化存储。
序列化格式：PEM格式、DER格式。

①PEM文件格式：
	--------BEGIN Type----------
	Header（可选）
	Body(Base64编码格式)
	--------END Type------------
	解释：
		type：代表类型，可以自定义指定
		header：头数据，可选，通常不填
		body：序列化后的数据，通常为base64格式
②DER格式：
	0x30：序列的开始
	0x45：序列的长度
	0x02：代表一个整数数值

地址的类型及特点：
	legacy类型：版本号0x00，地址以1xxx开头
	p2sh-segwit：版本号是0x05，地址以3xxxx开头
	bech32：地址以bc1qxxx开头

7、第八章：比特币网络
点对点，又称P2P，全称是：Peer-to-Peer

去中心化网络：节点全部对等，每个节点既是客户端，又是服务端。

比特币的完整节点：网络路由、钱包、区块链数据库、挖矿

节点的分类：全节点、轻节点
	a、全节点：维护了全部的区块链账本数据，可以进行查询服务和交易验证
	b、轻节点：只包含一部分数据，更新时只会更新区块头数据（80字节）
	利用SPV进行交易验证。

SPV：简单支付验证，全称是：Simplified payment verification。依赖于一条默克尔路径进行验证。

默克尔树：一颗哈希二叉数，自下而上构建。构建方法（两两组合，双hash，遇奇复尾）
①：默克尔树的构建过程（画图）P183
②：利用默克尔树验证交易，返回merkle路径。P184


8、第九章：区块链
① 区块链是由区块链接而成
② 区块由区块头和区块体组成
	区块头：80字节，6个字段（版上默，时难随）
	区块体：交易：
				交易输入
				交易输出

③ 比特币的运行规则：基础规则和推算规则
	a、平均每10分钟左右产生一个区块
	b、初始区块的奖励是50个BTC
	c、每经过210000个区块，区块奖励减半
	d、每经过2016个区块，比特币网络的难度值会进行调整
 ==>推算规则：
 	a、比特币系统约4年奖励减半
 	b、比特币的总量上线是无限接近于2100万BTC
 	c、2140年所有的比特币发行结束

④ 比特币的单位：
	最大：BTC
	uBTC、mBTC
	最小：sat
	1BTC = 100000000 sat 



















